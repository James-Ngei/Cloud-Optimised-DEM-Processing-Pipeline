<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SRTM COG Viewer - Kenya/Uganda Region</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { width: 100%; height: 100vh; }
        .info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 300px;
        }
        .info h3 { margin: 0 0 10px 0; color: #333; }
        .info p { margin: 5px 0; font-size: 14px; }
        .stats { 
            background: #f5f5f5; 
            padding: 10px; 
            border-radius: 4px; 
            margin-top: 10px;
            font-size: 12px;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 2000;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">Loading COG...</div>
    <div id="map"></div>
    <div class="info">
        <h3>üó∫Ô∏è SRTM COG Viewer</h3>
        <p><strong>Region:</strong> Kenya/Uganda</p>
        <p><strong>Resolution:</strong> ~30m</p>
        <div class="stats">
            <strong>Dataset Info:</strong><br>
            Size: 28,721 √ó 33,677 pixels<br>
            Elevation: -10m to 3,314m<br>
            Format: Cloud-Optimized GeoTIFF
        </div>
        <p><small>Pan and zoom to test COG performance. Notice how quickly tiles load!</small></p>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/georaster"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>
    
    <script>
        // Initialize map centered on the region
        const map = L.map('map').setView([2.5, 35.0], 8);
        
        // Base layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
        
        // Load COG
        console.log('Fetching COG...');
        fetch('http://localhost:8000/data/cog/srtm_cog.tif')
            .then(response => {
                console.log('COG response received');
                return response.arrayBuffer();
            })
            .then(arrayBuffer => {
                console.log('Parsing georaster...');
                return parseGeoraster(arrayBuffer);
            })
            .then(georaster => {
                console.log('Georaster loaded:', georaster);
                document.getElementById('loading').style.display = 'none';
                
                // Create color scale for elevation
                const min = georaster.mins[0];
                const max = georaster.maxs[0];
                
                const layer = new GeoRasterLayer({
                    georaster: georaster,
                    opacity: 0.8,
                    pixelValuation: values => {
                        const elevation = values[0];
                        if (elevation === undefined || elevation < -10) return null;
                        return elevation;
                    },
                    resolution: 256
                });
                
                layer.addTo(map);
                
                // Fit map to COG bounds
                map.fitBounds(layer.getBounds());
                
                console.log('COG layer added to map');
            })
            .catch(error => {
                console.error('Error loading COG:', error);
                document.getElementById('loading').innerHTML = 
                    '‚ùå Error loading COG<br><small>' + error.message + '</small>';
            });
    </script>
</body>
</html>